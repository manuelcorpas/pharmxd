<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="description" content="PharmXD - Pharmacogenomic Dosing Advisor. Get personalized medication dosing based on your genetic profile.">
    <meta name="theme-color" content="#2563eb">

    <!-- Open Graph / WhatsApp / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://manuelcorpas.github.io/pharmxd/">
    <meta property="og:title" content="PharmXD - Know How Your Genes Affect Your Medications">
    <meta property="og:description" content="Upload your 23andMe or AncestryDNA file to get personalized medication recommendations. 12 genes, 51 drugs analyzed. 100% private - data never leaves your device.">
    <meta property="og:image" content="https://manuelcorpas.github.io/pharmxd/icons/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="PharmXD - Know How Your Genes Affect Your Medications">
    <meta name="twitter:description" content="Upload your genetic data to get personalized medication recommendations. 12 genes, 51 drugs. 100% private.">
    <meta name="twitter:image" content="https://manuelcorpas.github.io/pharmxd/icons/og-image.png">

    <!-- iOS PWA meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="PharmXD">
    <meta name="mobile-web-app-capable" content="yes">

    <title>PharmXD - Pharmacogenomic Dosing Advisor</title>

    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">

    <!-- PWA manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Icons -->
    <link rel="icon" type="image/svg+xml" href="icons/icon.svg">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="header-top">
                <div class="logo">
                    <span class="logo-icon">üíä</span>
                    <span class="logo-text">PharmXD</span>
                </div>
                <button type="button" class="lang-toggle" id="lang-toggle" aria-label="Change language">
                    <span class="lang-flag">üá¨üáß</span>
                    <span class="lang-code">EN</span>
                </button>
            </div>
            <p class="tagline" data-i18n="tagline">Get personalized medication dosing based on your DNA</p>
            <p class="tagline-sub" data-i18n="taglineSub">Upload your 23andMe or AncestryDNA file to check if your genes affect how you respond to common medications</p>
        </header>

        <!-- Main Content -->
        <main class="app-main">
            <!-- Step 1: Upload Genetic Data -->
            <section id="step-upload" class="step active">
                <div class="step-header">
                    <span class="step-number">1</span>
                    <h2 data-i18n="step1Title">Upload Your Genetic Data</h2>
                </div>
                <div class="step-content">
                    <p class="step-description">
                        <span data-i18n="step1Desc">Upload your raw genetic data file from 23andMe, AncestryDNA, or similar services.</span>
                        <strong data-i18n="dataPrivacy">Your data stays on your device</strong><span data-i18n="dataPrivacyFull"> - nothing is uploaded to any server.</span>
                    </p>

                    <div class="upload-zone" id="upload-zone">
                        <input type="file" id="file-input" accept=".txt,.csv,.zip" style="display:none;">
                        <div class="upload-icon">üìÅ</div>
                        <p class="upload-text" data-i18n="dragDrop">Drag & drop your file here</p>
                        <p class="upload-or" data-i18n="or">or</p>
                        <button type="button" class="upload-button" id="upload-btn" data-i18n="chooseFile">Choose File</button>
                        <p class="upload-hint" data-i18n="fileHint">Accepts .txt or .csv files from 23andMe, AncestryDNA</p>
                    </div>

                    <div class="demo-section">
                        <p data-i18n="noData">No genetic data? Try a demo:</p>
                        <div class="demo-buttons">
                            <button class="demo-btn" data-demo="sarah">
                                <span class="demo-name" data-i18n="demoSarah">Sarah</span>
                                <span class="demo-desc" data-i18n="demoSarahDesc">CYP2C19 Intermediate</span>
                            </button>
                            <button class="demo-btn" data-demo="john">
                                <span class="demo-name" data-i18n="demoJohn">John</span>
                                <span class="demo-desc" data-i18n="demoJohnDesc">CYP2D6 Poor Metabolizer</span>
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Step 2: Genetic Profile -->
            <section id="step-profile" class="step">
                <div class="step-header">
                    <span class="step-number">2</span>
                    <h2 data-i18n="step2Title">Your Pharmacogenetic Profile</h2>
                </div>
                <div class="step-content">
                    <div id="profile-loading" class="loading hidden">
                        <div class="spinner"></div>
                        <p data-i18n="analyzing">Analyzing genetic variants...</p>
                    </div>

                    <div id="profile-results" class="hidden">
                        <div class="profile-summary">
                            <p><strong id="snp-count">0</strong> <span data-i18n="variantsAnalyzed">pharmacogenomic variants analyzed</span></p>
                            <button type="button" class="back-btn" id="upload-new-btn">üìÅ <span data-i18n="uploadNew">Upload New Genetic File</span></button>
                        </div>

                        <div class="gene-cards" id="gene-cards">
                            <!-- Gene cards will be inserted here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Results Summary Card -->
            <section id="step-summary" class="step">
                <div class="step-header">
                    <span class="step-number">3</span>
                    <h2 data-i18n="step3Title">Your Drug Response Summary</h2>
                </div>
                <div class="step-content">
                    <div id="summary-card" class="summary-card hidden">
                        <p class="summary-intro"><span data-i18n="summaryIntro">Based on your genetic profile, here's how you may respond to</span> <strong id="total-drugs-count">0</strong> <span data-i18n="medicationsInDb">medications in our database:</span></p>

                        <div class="summary-stats">
                            <div class="summary-stat standard">
                                <span class="stat-icon">‚úì</span>
                                <span class="stat-number" id="stat-standard">0</span>
                                <span class="stat-label" data-i18n="standardDosing">Standard dosing</span>
                            </div>
                            <div class="summary-stat caution">
                                <span class="stat-icon">‚ö†</span>
                                <span class="stat-number" id="stat-caution">0</span>
                                <span class="stat-label" data-i18n="useWithCaution">Use with caution</span>
                            </div>
                            <div class="summary-stat avoid">
                                <span class="stat-icon">‚úó</span>
                                <span class="stat-number" id="stat-avoid">0</span>
                                <span class="stat-label" data-i18n="avoidOrAlt">Avoid or use alternative</span>
                            </div>
                        </div>

                        <div id="alert-drugs" class="alert-drugs hidden">
                            <h4 data-i18n="medsAttention">Medications requiring attention:</h4>
                            <ul id="alert-drugs-list"></ul>
                        </div>

                        <button type="button" class="wallet-card-btn" id="wallet-card-btn">
                            üí≥ <span data-i18n="getWalletCard">Get Your Wallet Card</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Wallet Card Modal -->
            <div id="wallet-modal" class="modal hidden">
                <div class="modal-content wallet-modal-content">
                    <button class="modal-close" id="wallet-modal-close" aria-label="Close">&times;</button>
                    <div class="wallet-card-container">
                        <div class="wallet-card" id="wallet-card">
                            <div class="wallet-card-header">
                                <div class="wallet-logo">üíä PharmXD</div>
                                <div class="wallet-title" data-i18n="walletTitle">Pharmacogenetic Alert Card</div>
                            </div>
                            <div class="wallet-card-body">
                                <div class="wallet-section">
                                    <div class="wallet-label" data-i18n="walletProfile">My Genetic Profile</div>
                                    <div class="wallet-genes" id="wallet-genes"></div>
                                </div>
                                <div class="wallet-section wallet-avoid-section">
                                    <div class="wallet-label">‚ö†Ô∏è <span data-i18n="walletMedsAttention">Medications Requiring Attention</span></div>
                                    <div class="wallet-avoid-list" id="wallet-avoid-list"></div>
                                </div>
                            </div>
                            <div class="wallet-card-footer">
                                <div class="wallet-disclaimer" data-i18n="walletDisclaimer">Show this card to your doctor or pharmacist</div>
                                <div class="wallet-url">pharmxd.com</div>
                            </div>
                        </div>
                    </div>
                    <div class="wallet-actions">
                        <button type="button" class="wallet-action-btn" id="wallet-print-btn">üñ®Ô∏è <span data-i18n="printCard">Print Card</span></button>
                        <button type="button" class="wallet-action-btn" id="wallet-screenshot-btn">üì± <span data-i18n="saveImage">Save as Image</span></button>
                    </div>
                </div>
            </div>

            <!-- Step 4: Drug Lookup -->
            <section id="step-drugs" class="step">
                <div class="step-header">
                    <span class="step-number">4</span>
                    <h2 data-i18n="step4Title">Check Your Medications</h2>
                </div>
                <div class="step-content">
                    <div class="drug-search">
                        <input type="text"
                               id="drug-search-input"
                               data-i18n-placeholder="searchPlaceholder"
                               placeholder="Search for a medication..."
                               autocomplete="off">
                        <div id="drug-suggestions" class="suggestions hidden"></div>
                    </div>

                    <div class="common-drugs">
                        <p data-i18n="commonMeds">Common medications:</p>
                        <div class="drug-chips" id="drug-chips">
                            <button class="drug-chip" data-drug="clopidogrel">Clopidogrel</button>
                            <button class="drug-chip" data-drug="codeine">Codeine</button>
                            <button class="drug-chip" data-drug="warfarin">Warfarin</button>
                            <button class="drug-chip" data-drug="simvastatin">Simvastatin</button>
                            <button class="drug-chip" data-drug="omeprazole">Omeprazole</button>
                            <button class="drug-chip" data-drug="metoprolol">Metoprolol</button>
                            <button class="drug-chip" data-drug="sertraline">Sertraline</button>
                            <button class="drug-chip" data-drug="fluoxetine">Fluoxetine</button>
                        </div>
                    </div>

                    <div id="drug-result" class="drug-result hidden">
                        <!-- Drug result will be inserted here -->
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <div class="disclaimer">
                <strong data-i18n="disclaimer">Disclaimer:</strong> <span data-i18n="disclaimerText">PharmXD is for educational purposes only. It is not a substitute for professional medical advice. Always consult your physician or pharmacist before making medication decisions.</span>
            </div>
            <div class="footer-info">
                <p><span data-i18n="dataSources">Data sources:</span> <a href="https://cpicpgx.org/" target="_blank">CPIC</a> |
                   <a href="https://www.pharmgkb.org/" target="_blank">PharmGKB</a> |
                   <a href="https://www.fda.gov/" target="_blank">FDA</a></p>
                <p class="privacy">üîí <span data-i18n="privacyNote">Your genetic data never leaves your device</span></p>
            </div>
        </footer>
    </div>

    <!-- Result Modal -->
    <div id="result-modal" class="modal hidden">
        <div class="modal-content">
            <button class="modal-close" aria-label="Close">&times;</button>
            <div id="modal-body">
                <!-- Modal content inserted here -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/snp-parser.js"></script>
    <script src="js/phenotype.js"></script>
    <script src="js/cpic-lookup.js"></script>
    <script src="js/app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then((registration) => {
                        console.log('SW registered:', registration.scope);

                        // Check for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New content available, show update prompt
                                    if (confirm('New version available! Reload to update?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.log('SW registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
